\documentclass[main.tex]{subfiles}

\begin{document}

Um die Einrichtung so einfach wie möglich zu verwenden wird Puppet verwendet. Um vom Betriebssystem unabhänging daran zu arbeiten, verwenden wir Vagrant.

\subsection{Ausgeführte Schritte}
\begin{enumerate}
	\item Vagrant installieren (siehe Webseite)
	\item Mit \textit{vagrant init ubuntu/trusty64} ein neues Vagrant Enviroment erstellen.
	\item das \textit{Vagrantfile} umit folfende Zeilen erweitern: 
	\begin{lstlisting}
config.vm.provision :puppet do |puppet|
  puppet.manifests\_path = "manifests"
  puppet.module\_path = ["modules-contrib","modules-custom"]
end
	\end{lstlisting}
	\item Ordner anlegen: \textit{manifests}, \textit{modules-contrib} und \textit{modules-custom}
	\item Datei mit folgenden Inhalt anlegen: \textit{manifests/default.pp}
		\begin{lstlisting}
Exec { path => [ "/bin/", "/sbin/" , "/usr/bin/", "/usr/sbin/" ] }

include system-update

class { 'openldap::server':
  databases => {
    'dc=megaldap,dc=com' => {
      ensure => present,
      rootdn    => 'cn=root,dc=megaldap,dc=com',
      rootpw    => '{SSHA}LMhUx6cKrXXCv9RHHvjkUhrSJGJQeJbm',
    }
  }
}
		\end{lstlisting}
		Ein Passwort kann mit dem Kommando \textit{slappasswd} im Debian Paket \textit{slapd} gehasht werden.
		\item Datei mit folgenden Inhalt anlegen:
		\textit{modules-custom/system-update/manifests/init.pp}
		\begin{lstlisting}
class system-update {
  exec { 'system-update':
    command => 'apt-get update; apt-get dist-upgrade -y',
    logoutput => true,
  }
}
		\end{lstlisting}
		\item Puppet Modul \textit{camptocamp-openldap} mithilfe von Puppet in den Ordner \textit{modules-contrib} installieren:\\ \textit{puppet module install --modulepath=modules-contrib/ camptocamp-openldap}
		\item Mit dem Befehl \textit{vagrant up} VM starten und provisionieren. Wenn die VM gestartet ist, kann mit \textit{vagrant ssh} per SSH auf die VM zugegriffen werden.
\end{enumerate}

\subsection{phpLDAPadmin}
Um die Konfiguration zu erleichtern, haben wir das Puppet-Modul phpLDAPadmin zur 
Provisionierung hinzugefügt:

\begin{lstlisting}  
class { 'phpldapadmin':
  ldap_host      => 'localhost',
  ldap_suffix    => 'dc=megaldap,dc=com',
  ldap_bind_id   => 'cn=admin,dc=megaldap,dc=com',
  ldap_bind_pass => 'bigboss123',
}
->
exec { "phpldapadmin-fix":
    command => "sudo sed -i 's/password_hash/password_hash_custom/' /usr/share/phpldapadmin/lib/TemplateRender.php"
}
\end{lstlisting}

\subsection{Filesharing}
Um das Filesharing zu realisieren verwenden wir Samba

\end{document}